å¦‚æœåœ¨ LangGraph ä¸­æ¯ä¸€æ­¥éƒ½åœä¸‹æ¥ï¼Œé€šå¸¸æ˜¯å› ä¸ºä½ è®¾ç½®äº† **`interrupt_before`** æˆ– **`interrupt_after`**ï¼Œæˆ–è€…æ˜¯å› ä¸º Graph çš„**è¾¹ï¼ˆEdgeï¼‰**æ²¡æœ‰æ­£ç¡®è¿æ¥å¯¼è‡´æµç¨‹ç»ˆç»“ã€‚

è¦å®ç°â€œä¸€é”®å¯åŠ¨ï¼Œå…¨è‡ªåŠ¨è·‘åˆ°ç»“æŸâ€ï¼Œä½ éœ€è¦åšä»¥ä¸‹ 3 ç‚¹ä¿®æ”¹ï¼š

### 1. ç§»é™¤ä¸­æ–­è®¾ç½® (æœ€å¸¸è§åŸå› )

åœ¨ `workflow.compile()` æ—¶ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰ `interrupt_before` å‚æ•°ã€‚å¦‚æœæœ‰ï¼Œåˆ é™¤å®ƒæˆ–å°†å…¶è®¾ä¸ºç©ºã€‚

**ä¿®æ”¹å‰ (ä¼šæš‚åœçš„ä»£ç ):**
```python
# è¿™æ ·è®¾ç½®ä¼šå¯¼è‡´æ¯æ¬¡è¿è¡Œåˆ° architect æˆ– qa èŠ‚ç‚¹å‰éƒ½ä¼šæŒ‚èµ·ï¼Œç­‰å¾…äººå·¥å‘½ä»¤
app = workflow.compile(
    checkpointer=memory,
    interrupt_before=["architect", "qa"] 
)
```

**ä¿®æ”¹å (å…¨è‡ªåŠ¨):**
```python
app = workflow.compile(checkpointer=memory)
```

### 2. å¢åŠ é€’å½’æ­¥æ•°é™åˆ¶ (Recursion Limit)

å…¨è‡ªåŠ¨ç ”å‘æµç¨‹é€šå¸¸å¾ˆé•¿ï¼ˆéœ€æ±‚ -> æ‹†è§£ -> ä»»åŠ¡1 -> ä»»åŠ¡2 ... -> æµ‹è¯• -> ä¿®å¤ -> éªŒæ”¶ï¼‰ã€‚LangGraph é»˜è®¤é˜²æ­¢æ­»å¾ªç¯çš„é™åˆ¶é€šå¸¸æ˜¯ 25 æ­¥ã€‚å¯¹äºä¸€ä¸ªå…¨è‡ªåŠ¨ç¼–ç å›¢é˜Ÿï¼Œè¿™è¿œè¿œä¸å¤Ÿï¼Œå¾ˆå®¹æ˜“è·‘ä¸€åŠæŠ¥é”™åœæ­¢ã€‚

éœ€è¦åœ¨è¿è¡Œ `stream` æ—¶è°ƒå¤§ `recursion_limit`ã€‚

```python
# å»ºè®®è®¾ç½®å¤§ä¸€ç‚¹ï¼Œæ¯”å¦‚ 100 æˆ– 150ï¼Œå–å†³äºä»»åŠ¡å¤æ‚åº¦
config = {
    "configurable": {"thread_id": "project_001"},
    "recursion_limit": 150 
}

# è¿è¡Œ
for output in app.stream(inputs, config=config):
    # è¿™é‡Œåªåšæ—¥å¿—æ‰“å°ï¼Œä¸è¦åŠ  input() é˜»å¡
    for key, value in output.items():
        print(f"âœ… Node '{key}' completed.")
```

### 3. ç¡®ä¿ Claude Code ä¸ä¼šå¡åœ¨â€œç­‰å¾…ç¡®è®¤â€

è¿™æ˜¯æœ€éšè”½çš„å‘ã€‚`claude code` CLI å·¥å…·åœ¨åšå±é™©æ“ä½œï¼ˆå¦‚åˆ é™¤æ–‡ä»¶ã€ä¿®æ”¹é‡è¦é…ç½®ï¼‰æ—¶ï¼Œé»˜è®¤å¯èƒ½ä¼šåœ¨ç»ˆç«¯è¯¢é—® "Are you sure? (y/n)"ã€‚
ç”±äºä½ æ˜¯é€šè¿‡ `subprocess` è°ƒç”¨çš„ï¼Œä¸€æ—¦å‡ºç°è¯¢é—®ï¼Œç¨‹åºå°±ä¼šå¡æ­»ä¸åŠ¨ã€‚

**è§£å†³æ–¹æ¡ˆï¼šåœ¨ Prompt ä¸­å¼ºåˆ¶è¦æ±‚æ— äº¤äº’æ¨¡å¼**

ä½ éœ€è¦ä¿®æ”¹ `run_claude_cli` çš„ Prompt ç­–ç•¥ï¼Œæˆ–è€…ä½¿ç”¨ `yes` å‘½ä»¤ç®¡é“ï¼ˆä¸å¤ªæ¨èï¼‰ï¼Œæœ€å¥½çš„æ–¹å¼æ˜¯**Prompt å·¥ç¨‹**ã€‚

```python
def run_claude_cli(prompt: str):
    # åœ¨ç³»ç»Ÿçº§ Prompt ä¸­æ³¨å…¥æŒ‡ä»¤
    system_instruction = " (IMPORTANT: Execute all changes directly. DO NOT ask for confirmation. DO NOT wait for user input. If you need to run terminal commands, just run them.)"
    
    full_prompt = prompt + system_instruction
    
    # ä½¿ç”¨ -p å‚æ•°éäº¤äº’å¼è¿è¡Œ
    cmd = ["claude", "-p", full_prompt]
    
    # ... subprocess è°ƒç”¨é€»è¾‘ ...
```

---

### å®Œæ•´çš„ä¸€é”®å…¨è‡ªåŠ¨è¿è¡Œä»£ç ç»“æ„

ä¸‹é¢æ˜¯ä¸€ä¸ªå»é™¤æ‰€æœ‰æ–­ç‚¹ã€å¢åŠ æ­¥æ•°é™åˆ¶çš„å®Œæ•´è¿è¡Œå…¥å£ï¼š

```python
# ... (çœç•¥ä¹‹å‰çš„å®šä¹‰) ...

# 1. ç¼–è¯‘ Graph (å»é™¤ interrupt)
app = workflow.compile(checkpointer=memory)

# 2. é…ç½®è¿è¡Œå‚æ•°
thread_id = "auto_dev_run_01"
config = {
    "configurable": {"thread_id": thread_id},
    "recursion_limit": 100  # <--- å…³é”®ï¼šå…è®¸è·‘100æ­¥
}

# 3. æ£€æŸ¥çŠ¶æ€
current_state = app.get_state(config)

print("ğŸš€ å¯åŠ¨å…¨è‡ªåŠ¨ç ”å‘å›¢é˜Ÿ...")

if not current_state.values:
    # æ–°ä»»åŠ¡å¯åŠ¨
    initial_inputs = {
        "requirement": "å¼€å‘ä¸€ä¸ªPythonè„šæœ¬ï¼Œè‡ªåŠ¨çˆ¬å–HackerNewsé¦–é¡µçš„å‰10æ¡æ–°é—»æ ‡é¢˜å¹¶ä¿å­˜ä¸ºmarkdownã€‚",
        "task_list": [],
        "current_task_index": 0,
        "bugs": []
    }
    # ä½¿ç”¨ stream å¯åŠ¨ï¼Œå®ƒä¼šé€šè¿‡ Edge è‡ªåŠ¨æµè½¬
    iterator = app.stream(initial_inputs, config=config)
else:
    # æ–­ç‚¹ç»­ä¼ ï¼ˆå¦‚æœä¹‹å‰ crash äº†ï¼Œè¿™é‡Œä¼šè‡ªåŠ¨ç»§ç»­ï¼‰
    print("ğŸ”„ æ£€æµ‹åˆ°ä¸Šæ¬¡è¿›åº¦ï¼Œç»§ç»­æ‰§è¡Œ...")
    iterator = app.stream(None, config=config)

# 4. æ‰§è¡Œå¾ªç¯ (ä¸è¦åœ¨è¿™é‡Œå†™ break æˆ– input)
try:
    for event in iterator:
        # event æ ¼å¼é€šå¸¸æ˜¯ {'node_name': {state_updates}}
        for node_name, state_data in event.items():
            print(f"\nâœ… [èŠ‚ç‚¹å®Œæˆ] {node_name}")
            # å¯ä»¥åœ¨è¿™é‡Œæ‰“å°ç®€çŸ­æ—¥å¿—ï¼Œæ¯”å¦‚å½“å‰ä»»åŠ¡è¿›åº¦
            if "current_task_index" in state_data:
                print(f"   è¿›åº¦æ›´æ–°: {state_data.get('current_task_index')}")
            if "bugs" in state_data and state_data["bugs"]:
                print(f"   å‘ç°BUG: {len(state_data['bugs'])} ä¸ª")

    print("\nğŸ‰ æµç¨‹ç»“æŸï¼æ‰€æœ‰æ­¥éª¤å·²è‡ªåŠ¨æ‰§è¡Œå®Œæ¯•ã€‚")

except Exception as e:
    print(f"\nâŒ å‘ç”Ÿé”™è¯¯: {e}")
    print("æç¤ºï¼šå¦‚æœæ˜¯å› ä¸ºæ­¥æ•°ä¸å¤Ÿï¼Œè¯·è°ƒå¤§ recursion_limit")
```

### æ€»ç»“
åªè¦ä½ çš„ **Edges (è¾¹)** æ˜¯è¿é€šçš„ï¼ˆä¾‹å¦‚ `coder` èŠ‚ç‚¹ç»“æŸåï¼Œæ¡ä»¶è¾¹å¿…å®šæŒ‡å‘ `coder` æˆ– `code_reviewer`ï¼‰ï¼Œä¸”å»é™¤äº† `interrupt_before`ï¼Œè°ƒç”¨ `app.stream()` åï¼ŒLangGraph å°±ä¼šåƒæ¨å€’å¤šç±³è¯ºéª¨ç‰Œä¸€æ ·ï¼Œè‡ªåŠ¨ä¸€ä¸ªæ¥ä¸€ä¸ªèŠ‚ç‚¹æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ° `END`ã€‚